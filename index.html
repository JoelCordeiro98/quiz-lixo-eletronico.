<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üß† Quiz: Descarte Consciente do Lixo Eletr√¥nico</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<style>
  :root{
    --bg-1: #071019;
    --accent: #00e1a6;
    --accent-2:#00b0ff;
    --muted: rgba(255,255,255,0.85);
  }
  html,body{height:100%;margin:0;font-family:Inter, "Segoe UI", Tahoma, sans-serif;background:#071019; color:var(--muted);}
  .bg-canvas{position:fixed;inset:0;z-index:0;pointer-events:none}
  .overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0.25),rgba(0,0,0,0.55));z-index:1}
  .wrap{position:relative;z-index:2;max-width:920px;margin:40px auto;padding:24px;}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    backdrop-filter: blur(8px);
    border-radius:16px;
    padding:26px;
    color:var(--muted);
    transition:transform .35s ease,opacity .35s ease;
    opacity:0; transform: translateY(18px);
  }
  .card.show{ opacity:1; transform:translateY(0); }
  .header { display:flex; align-items:center; gap:16px; justify-content:center; flex-wrap:wrap; }
  .logo { width:140px; height:auto; border-radius:6px; box-shadow: 0 6px 20px rgba(0,0,0,0.45); background:rgba(255,255,255,0.02); padding:6px; }
  .title-block {text-align:center;}
  h1{margin:0;color:var(--accent-2); font-size:22px;}
  .subtitle{margin-top:6px;color:rgba(255,255,255,0.7);font-size:13px}
  .project{margin-top:8px;color:var(--accent);font-weight:700}
  .start-area{max-width:560px;margin:18px auto 0;}
  input[type=text], input[type=number]{
    width:100%; padding:12px 14px; border-radius:10px; border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02); color:var(--muted); outline:none; font-size:15px; margin-top:8px;
  }
  .btn { display:inline-flex; align-items:center; gap:10px; justify-content:center; padding:12px 18px; border-radius:12px; cursor:pointer; border:0;
    background: linear-gradient(90deg,var(--accent),var(--accent-2)); color:#062022; font-weight:700; font-size:15px; margin-top:12px; }
  .qr-wrap{margin:12px 0; text-align:center;}
  .small-note{font-size:13px;color:rgba(255,255,255,0.6); margin-top:8px}
  .quiz-card { padding:28px; max-width:760px; margin:20px auto; }
  .timer-bar{width:100%;height:12px;background:rgba(255,255,255,0.06);border-radius:8px; overflow:hidden;}
  .timer-fill{height:100%;background:linear-gradient(90deg,var(--accent-2),var(--accent)); width:100%; transition:width 1s linear;}
  .question-text{font-size:20px;color:#dffcf0;margin:18px 0}
  .options{display:flex;flex-direction:column;gap:12px;align-items:stretch;}
  .option {
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.04); padding:12px 14px; border-radius:14px; color:var(--muted);
    cursor:pointer; font-size:15px; transition:transform .18s, box-shadow .18s, background .18s;
  }
  .option:hover{ transform: translateY(-6px); box-shadow: 0 10px 30px rgba(2,6,23,0.6); }
  .option.correct{ background: linear-gradient(90deg, rgba(0,210,160,0.12), rgba(0,176,255,0.06)); border-color: rgba(0,210,160,0.6); color:#e8fff6; }
  .option.wrong{ background: linear-gradient(90deg, rgba(255,120,120,0.07), rgba(255,80,80,0.03)); border-color: rgba(255,80,80,0.45); color:#ffecec; }
  .result { text-align:center; font-size:18px; color:var(--muted); margin-top:14px }
  footer.small { margin-top:12px; font-size:12px; color:rgba(255,255,255,0.55); text-align:center }
  @media (max-width:720px){ .logo{width:120px} .card{margin:18px} }
</style>
</head>
<body>
<canvas id="bg" class="bg-canvas"></canvas>
<div class="overlay"></div>

<div class="wrap">
  <div class="card" id="startCard">
    <div class="header">
      <img id="unina-logo" class="logo" alt="UNINASSAU Logo"
        src="https://www.globalbox.com.br/wp-content/uploads/2023/01/CENTRO-UNIVERSITARIO-UNIVERITAS-300x285.png">
      <div class="title-block">
        <h1>üß† Quiz: Descarte Consciente do Lixo Eletr√¥nico</h1>
        <div class="subtitle">Aprenda, participe e promova o descarte respons√°vel</div>
        <div class="project">Projeto de Extens√£o Uninassau</div>
      </div>
    </div>

    <div class="start-area">
      <div class="qr-wrap">
        <canvas id="qrcode" width="160" height="160"></canvas>
        <div class="small-note">Escaneie para abrir o quiz neste link em outro dispositivo</div>
      </div>

      <form id="userForm">
        <label><b>Nome</b></label>
        <input id="nome" type="text" required placeholder="Seu nome">
        <label><b>Idade</b></label>
        <input id="idade" type="number" required placeholder="Sua idade">
        <div style="text-align:center">
          <button class="btn" type="submit" id="startBtn">Come√ßar Quiz</button>
        </div>
      </form>
    </div>
    <footer class="small">Tema: IA aplicada ao descarte consciente ‚Ä¢ Visual: ambiental + tecnol√≥gico</footer>
  </div>

  <div class="card" id="quizCard" style="display:none;">
    <div class="quiz-card">
      <div class="timer-bar"><div id="timerFill" class="timer-fill"></div></div>
      <div id="timerText" style="color:var(--muted); margin-top:8px; text-align:center">Tempo: 20s</div>
      <div id="questionBox" style="margin-top:12px"></div>
    </div>
  </div>

  <div class="card" id="resultCard" style="display:none; text-align:center;">
    <h2 style="color:var(--accent-2)">Resultado Final</h2>
    <div id="resultText" class="result"></div>
    <div style="margin-top:14px">
      <button id="restartBtn" class="btn">Reiniciar Quiz</button>
    </div>
    <div style="margin-top:12px">
      <div id="savingStatus" style="font-size:13px;color:var(--muted)"></div>
    </div>
  </div>
</div>

<script>
/* CONFIG */
const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwYgJIdtiocZdMnXr_ZTGImzvQgFB1ITsg-WtXdpiClOhNXyOz7m72jXsogRtRx4iH5sQ/exec";
const GITHUB_PAGES_LINK = "https://joelcordeiro98.github.io/quiz-lixo-eletronico./"; 

/* QUIZ DATA */
const quizData = [
  {q:"O que √© considerado lixo eletr√¥nico (e-lixo)?", a:["Apenas pilhas e baterias","Qualquer tipo de lixo produzido em casa","Equipamentos eletr√¥nicos e el√©tricos que se tornaram obsoletos ou quebrados","Apenas celulares e computadores"], c:2},
  {q:"Qual √© o principal risco do descarte incorreto do lixo eletr√¥nico?", a:["Aumentar o consumo de energia el√©trica","Contamina√ß√£o do solo, da √°gua e do ar","Reduzir a produ√ß√£o de novos produtos","Dificultar o transporte de res√≠duos"], c:1},
  {q:"Quais subst√¢ncias perigosas podem estar presentes no e-lixo?", a:["C√°lcio, Ferro e Zinco","Alum√≠nio, Ouro e Prata","Chumbo, Merc√∫rio e C√°dmio","Cobre, L√≠tio e Carbono"], c:2},
  {q:"Qual √© a consequ√™ncia da perda de materiais valiosos no descarte incorreto?", a:["Aumento do desemprego","Desperd√≠cio de recursos que poderiam ser reciclados","Maior produ√ß√£o de lixo dom√©stico","Diminui√ß√£o da coleta seletiva"], c:1},
  {q:"O que representam os 3 R's da sustentabilidade?", a:["Reutilizar, Recarregar e Reparar","Reduzir, Reutilizar e Reciclar","Recolher, Recuperar e Reaproveitar","Reestruturar, Redefinir e Reaplicar"], c:1},
  {q:"O que a 'log√≠stica reversa' determina por lei?", a:["Que apenas consumidores sejam respons√°veis pelo descarte","Que as empresas devem receber de volta produtos usados para descarte correto","Que o lixo eletr√¥nico seja misturado ao lixo comum","Que os pontos de coleta sejam criados apenas em escolas"], c:1},
  {q:"O que deve ser feito antes de descartar um celular ou computador?", a:["Quebrar o aparelho para evitar reutiliza√ß√£o","Guardar as pe√ßas √∫teis","Apagar todos os dados pessoais e fazer backup","Jogar apenas a bateria no lixo comum"], c:2},
  {q:"Qual √© uma fun√ß√£o da Intelig√™ncia Artificial no processo de reciclagem?", a:["Aumentar o tempo de decomposi√ß√£o dos materiais","Separar materiais de forma autom√°tica e precisa","Substituir os pontos de coleta por aplicativos","Reduzir a produ√ß√£o de lixo eletr√¥nico"], c:1},
  {q:"Como a IA ajuda na coleta de lixo eletr√¥nico?", a:["Criando rob√¥s que fazem o descarte","Controlando o peso dos res√≠duos","Otimizando rotas para reduzir custos e emiss√µes de carbono","Coletando lixo eletr√¥nico apenas em √°reas industriais"], c:2},
  {q:"Qual √© o grande objetivo da uni√£o entre IA e descarte consciente?", a:["Substituir o trabalho humano na coleta","Criar novos tipos de lixo eletr√¥nico","Tornar o processo de reciclagem mais sustent√°vel, eficiente e preciso","Aumentar o consumo de produtos eletr√¥nicos"], c:2}
];

/* ESTADO */
let current = 0, correct = 0, timerId = null, timeLeft = 20;
let audioContext = null;
let audioUnlocked = false;

/* SISTEMA DE √ÅUDIO */
function initAudio() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
}

function playSound(frequency, duration, type) {
  if (!audioContext || !audioUnlocked) return;
  
  try {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = frequency;
    oscillator.type = type;
    
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + duration);
  } catch (error) {
    console.log('√Åudio n√£o dispon√≠vel:', error);
  }
}

function playCorrectSound() {
  playSound(800, 0.3, 'sine');
}

function playWrongSound() {
  playSound(400, 0.3, 'sine');
}

function playClickSound() {
  playSound(600, 0.1, 'square');
}

function playTickSound() {
  playSound(300, 0.05, 'square');
}

function unlockAudio() {
  if (!audioUnlocked && audioContext) {
    audioContext.resume().then(() => {
      audioUnlocked = true;
      console.log('√Åudio desbloqueado!');
      playSound(200, 0.1, 'sine');
    });
  }
}

/* UI HELPERS */
function show(el){ el.style.display='block'; setTimeout(()=>el.classList.add('show'),20); }
function hide(el){ el.classList.remove('show'); setTimeout(()=>el.style.display='none',320); }

/* INIT */
document.addEventListener('DOMContentLoaded', ()=>{
  new QRious({ element: document.getElementById('qrcode'), value: GITHUB_PAGES_LINK, size:160 });
  show(document.getElementById('startCard'));
  initAudio();
  document.getElementById('startBtn').addEventListener('click', unlockAudio);
});

/* BACKGROUND ANIM */
(function bgAnim(){
  const c = document.getElementById('bg');
  const ctx = c.getContext('2d');
  let W, H, particles=[];
  function resize(){ W=c.width=innerWidth; H=c.height=innerHeight; initParticles(); }
  function initParticles(){
    particles = [];
    for(let i=0;i<60;i++){
      particles.push({x:Math.random()*W, y:Math.random()*H, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3, r:1+Math.random()*2, phase:Math.random()*Math.PI*2});
    }
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    const g=ctx.createLinearGradient(0,0,W,H);
    g.addColorStop(0,'rgba(0,16,20,0.25)'); g.addColorStop(1,'rgba(2,8,14,0.45)');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    ctx.lineWidth=0.8;
    for(let p of particles){
      p.x += p.vx; p.y += p.vy; p.phase += 0.01;
      if(p.x<0)p.x=W; if(p.x>W)p.x=0; if(p.y<0)p.y=H; if(p.y>H)p.y=0;
      ctx.beginPath();
      ctx.fillStyle = `rgba(0,225,166,${0.08 + 0.2*Math.sin(p.phase)})`;
      ctx.arc(p.x,p.y,p.r+1*Math.abs(Math.sin(p.phase)),0,Math.PI*2); ctx.fill();
    }
    for(let i=0;i<particles.length;i++){
      for(let j=i+1;j<particles.length;j++){
        const a=particles[i], b=particles[j];
        const dx=a.x-b.x, dy=a.y-b.y; const d2=dx*dx+dy*dy;
        if(d2<90000){
          ctx.beginPath();
          const alpha = 0.008*(90000 - d2);
          ctx.strokeStyle = `rgba(0,176,255,${alpha})`;
          ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
        }
      }
    }
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize', resize);
  resize(); draw();
})();

/* QUIZ FLOW */
document.getElementById('userForm').addEventListener('submit', e=>{
  e.preventDefault();
  unlockAudio();
  current = 0; correct = 0;
  hide(document.getElementById('startCard'));
  document.getElementById('quizCard').style.display = 'block';
  setTimeout(()=>show(document.getElementById('quizCard')),50);
  showQuestion();
});

function showQuestion(){
  timeLeft = 20;
  updateTimerUI();
  clearInterval(timerId);

  const q = quizData[current];
  const box = document.getElementById('questionBox');
  box.innerHTML = `<div class="question-text"><b>${current+1}. ${q.q}</b></div>
    <div class="options">${q.a.map((opt,i)=>`<div class="option" data-i="${i}">${opt}</div>`).join('')}</div>`;

  const opts = box.querySelectorAll('.option');
  opts.forEach(o=>{
    o.replaceWith(o.cloneNode(true));
  });
  
  const opts2 = box.querySelectorAll('.option');
  opts2.forEach(o=>{
    o.addEventListener('click', ()=> { 
      playClickSound();
      checkAnswer(parseInt(o.dataset.i)); 
    });
  });

  resetTimer();
}

function resetTimer(){
  clearInterval(timerId);
  timeLeft = 20;
  updateTimerUI();
  timerId = setInterval(()=>{
    timeLeft--;
    updateTimerUI();
    if(timeLeft<=3 && timeLeft>0){ 
      playTickSound();
    }
    if(timeLeft<=0){ 
      clearInterval(timerId); 
      markAnswer(null); 
    }
  },1000);
}

function updateTimerUI(){
  document.getElementById('timerText').innerText = `Tempo: ${timeLeft}s`;
  document.getElementById('timerFill').style.width = Math.max(0,(timeLeft/20)*100) + '%';
}

function checkAnswer(index){
  clearInterval(timerId);
  markAnswer(index);
}

function markAnswer(index){
  const q = quizData[current];
  const opts = document.querySelectorAll('.option');
  opts.forEach((el,i)=>{
    el.style.pointerEvents='none';
    if(i===q.c) el.classList.add('correct');
    if(index!==null && i===index && i!==q.c) el.classList.add('wrong');
  });
  
  if(index===q.c){ 
    playCorrectSound();
    correct++; 
  }
  else if(index!==null){ 
    playWrongSound();
  }
  
  setTimeout(()=>{ nextQuestion(); }, 1100);
}

function nextQuestion(){
  current++;
  if(current < quizData.length){
    showQuestion();
  } else {
    finishQuiz();
  }
}

/* ENVIAR PARA GOOGLE SHEETS - VERS√ÉO CORRIGIDA */
async function enviarResultadosParaSheets(dados) {
  try {
    console.log('üì§ Dados preparados para envio:', dados);
    
    // M√âTODO 1: FormData (mais compat√≠vel com Apps Script)
    const formData = new FormData();
    formData.append('nome', dados.nome);
    formData.append('idade', dados.idade.toString());
    formData.append('acertos', dados.acertos.toString());
    formData.append('total', dados.total.toString());
    formData.append('data', dados.data);

    console.log('üìù Enviando via FormData...');
    
    const response = await fetch(APP_SCRIPT_URL, {
      method: 'POST',
      body: formData
    });

    console.log('üì® Resposta recebida:', response.status, response.statusText);

    if (response.ok) {
      const result = await response.text();
      console.log('‚úÖ Sucesso! Resposta:', result);
      return { success: true, data: result };
    } else {
      console.warn('‚ö†Ô∏è POST falhou, tentando m√©todo alternativo...');
      
      // M√âTODO 2: URL Parameters como fallback
      try {
        const params = new URLSearchParams();
        params.append('nome', dados.nome);
        params.append('idade', dados.idade.toString());
        params.append('acertos', dados.acertos.toString());
        params.append('total', dados.total.toString());
        params.append('data', dados.data);

        const urlComParams = APP_SCRIPT_URL + '?' + params.toString();
        console.log('üîÑ Tentando URL com params:', urlComParams);

        const getResponse = await fetch(urlComParams, {
          method: 'GET',
          mode: 'no-cors'
        });
        
        console.log('üì° GET enviado (no-cors)');
        return { success: true, method: 'get-no-cors' };
      } catch (getError) {
        console.error('‚ùå GET tamb√©m falhou:', getError);
        return { success: false, error: `POST: ${response.status}, GET: ${getError.message}` };
      }
    }
  } catch (err) {
    console.error('üí• Erro geral no envio:', err);
    return { success: false, error: err.message };
  }
}

async function finishQuiz() {
  hide(document.getElementById('quizCard'));
  document.getElementById('resultCard').style.display = 'block';
  setTimeout(() => show(document.getElementById('resultCard')), 30);
  
  const percent = ((correct / quizData.length) * 100).toFixed(1);
  document.getElementById('resultText').innerHTML = `Voc√™ acertou <strong>${correct}</strong> de ${quizData.length} quest√µes (${percent}%).`;

  const nome = document.getElementById('nome').value.trim();
  const idade = parseInt(document.getElementById('idade').value) || 0;

  // VERIFICAR SE OS DADOS EST√ÉO CORRETOS
  console.log('üîç DADOS DO QUIZ:');
  console.log('Nome:', nome);
  console.log('Idade:', idade);
  console.log('Acertos:', correct);
  console.log('Total:', quizData.length);
  console.log('Porcentagem:', percent + '%');

  const payload = {
    nome: nome,
    idade: idade,
    acertos: correct,
    total: quizData.length,
    data: new Date().toISOString()
  };

  const status = document.getElementById('savingStatus');
  status.innerText = 'üíæ Conectando com a planilha...';
  
  console.log('üöÄ INICIANDO ENVIO PARA GOOGLE SHEETS...');
  const res = await enviarResultadosParaSheets(payload);
  
  if (res.success) {
    status.innerText = '‚úÖ Dados salvos com sucesso!';
    status.style.color = '#00e1a6';
    console.log('üéâ ENVIO BEM SUCEDIDO!');
  } else {
    status.innerText = '‚ö†Ô∏è Erro ao salvar online. Dados guardados localmente.';
    status.style.color = '#ff6b6b';
    console.error('‚ùå FALHA NO ENVIO:', res.error);
  }

  // BACKUP LOCAL SEMPRE
  try {
    const fallback = JSON.parse(localStorage.getItem('quizBackup') || '[]');
    const backupData = {
      nome: nome,
      idade: idade,
      acertos: correct,
      total: quizData.length,
      percentual: percent + '%',
      data: new Date().toLocaleString('pt-BR'),
      timestamp: Date.now()
    };
    fallback.push(backupData);
    localStorage.setItem('quizBackup', JSON.stringify(fallback));
    console.log('üíæ Backup local salvo:', backupData);
  } catch (e) {
    console.error('‚ùå Erro no backup local:', e);
  }
}

/* REINICIAR */
document.getElementById('restartBtn').addEventListener('click', () => {
  current = 0;
  correct = 0;
  timeLeft = 20;
  document.getElementById('resultCard').style.display = 'none';
  document.getElementById('quizCard').style.display = 'block';
  setTimeout(() => show(document.getElementById('quizCard')), 30);
  showQuestion();
});
</script>
</body>
</html>
